import { decodeMap, decodeMapStructured } from '.';

describe('decodeMapV0', () => {
  test('basic usage', () => {
    const result = decodeMap(
      '0000050000ef00770352030c00050000000000001bc905ad1fff0100ffffffe02ff00ff203263ffc003f3c00262f00003b000f2f55572400023fc0001f1800020802001ffc24000348f000007f27000f0200021ff02400033f0000012f00020902001fc024000249f000000727000f0200020f2400023ffc0000cb000304020001bf0134fc00171000060200003b000fcb000303020011fcbf011ff06000015f00000000012b010641fd7ffff0440041c0007fc3090007020011f03c000711000a0200c1f03fff03ffffff557f0001fcbc0007020001b2000f07010202020020c0ff330061fc01fc0001c0bc000702000076000f2b0109bc03fff03ffffff0055000047b0210c03a000f1a020843fc0fffc027001b10b30001ed000f1a020921f00fef000025000b770002ed000f1a020921c03fef000025000b77000013000002000f09030532d5ff40ef004700000010250103c6000102000fde01054047fd03ffd5014ac0000055770003ed000fef000750fd15400fff340041000005506e0004020004ed000fef000740f400003f910240fc00400043000602000036000202000fef000553d000103fd4a10002180212013f0003da01000200125f12000d020031400140a20130040000980232ffffc0ab0305ed000f45030740fd4000033f0500dd00019b0001760431f5555435000202001f0167010440fd00000f550200670001230000a200225550350003020003c5000d020040f400000fac0031c00040230053f000005555340004020002c5000e020040d00014015f0103680300bb000d020001cc000f02000052400140103f34000023000d380000020001cc000e020053fd000500517e023a7ffff5e80003020001cc000f02000013f4ac0000930400f500032f000902000fef000512d43f0500430020055f6c010f02000000cc000f02000120d00094010107002f007f3800000002000fef000420ff4034000207001f016401020fef000711fde80011fdd1011f07b300040fef000501e800038002101584000f0200000fef00090f02000d0fef00090f02000c00b1020f0200011ff538000c2d0003fe0430fffff4c3020f4702040802001f0c3c000011d08a0038d0000129000f020003024c04019401020b001140c4053f40001530000308020001380000020000ae03014300002e093ffd0000fc020208020001dc00020200007c021103c602110f06000f02000c02350003020000ff014005555540420010fd0d000f0200080113010602000083020402000154020f02000707ad00020200082f00103fc0000f020005022f00090200092f000fb300070934000302001ff52f00070602000f3703021bfd76050f0200020b21010402000fdb03040902000f3403050fdb03040802000f1205050f0605050802000fec00020202000fb6000a02e9020f0200080865000902002f55553600080302000fbe05031f053a00100db8000384030fcf04050d020008ac0012740d000f9b01050c02000831012101d554030f9b01070a020009e60111075b031f01d70c030d020002a400040200111f2b051d4326000f02000008af000102006d5ffffff45540ab030f020000012f00090200537fffffd1ff1b090f02000a02760011043d00110190080024012157fffe040f02000c02260110103c00210557720402bf021ffc38000c00020001f903113f06000343040f13021601e80402060000f7020044000f270a050d020011f4140122f55403050144000f4f021521ffd0470621ffd04300010207002b010f02001303020210404e060086000d580c0f02000e13fd920131d0000433010f02001913f72d003f4000103c001e03020042fd00005548070f02001f52f50001ffc03d010f02001e52f40017ffc036010f02001e42d0157fff24020f02001f114057030060020f02001e21fd0357030fb903110d02000023093ffc005478002200880d13f026020f0200211ff06701240002000fa301250002000f3c00290fa301240102000f0b032501d4060fde01220202001fd5ae04160f0200ffffffdd50ffffff0100'
    );

    expect(result.mapHeader).toEqual({
      mapHeaderStr: '0000050000ef00770352030c00050000000000001bc905ad',
      version: 0,
      id: 5,
      mapStable: false,
      mapWidth: 239,
      mapHeight: 119,
      originX: 85,
      originY: 78,
      mapResolution: 0.05,
      chargeX: 0,
      chargeY: 0,
      chargeDirection: undefined,
      chargePositionTransformed: null,
      dataLengthBeforeCompress: 7113,
      dataLengthAfterCompress: 1453,
    });

    expect(result.mapData.mapPointsStr.length).toBe(56882);
    expect(result.mapData.mapRooms).toEqual([]);
  });
});

describe('decodeMapV1', () => {
  test('basic usage', () => {
    const result = decodeMap(
      '01001200004f00c7019002da0005012c02e400003df808431fff01000811f901000f2100080f02001c4f0808080833001c0f0200090f4f00400f9f0037009d000fee0038004d000f4f003d0f5c01090f02001b009c000f3b0137024f000f5000370f4f00ffffffff8e1ff9f0043b3ff908083f053912f93c050f8e05350f4f008601e9080f9e00380133010502000f4d071b0f020000054a000102000f2100000f02001b0146000502000f3c001b0f020000054a000102000f2100000f02001b0146000502000f3c001b0f020001054b000002000f2100010f02001b0046000502000f3b001b0f020001054b000002000f2100010f02001c0047000402000f3b001c0f020001044b000002000f2000010f02001d0048000302000f3b001d0f020001034b000002000f1f00010f02001e0049000202000f3b001e0f020001024b000002000f1e00010f02001f004a000102000f3b001f0f020001014b000002000f1d00010f02001f004a000102000f3b001f0f020002014c000f7b0635077e06010d000f02002f042f06034a000509000f0200240a4f0000f9000f490024020200004f0000040002470d0f4f0032010200005e000509000f020026019a0000020000420000080002a7000f0200230bba070f4f002e0141000302000f4d092f05eb000702000fe800230102000f4f0003220404c2080f020004013a000002000e20000796000402002fff0401000b00b30a0302000433000f020008009d000f02000a0f4f001c0f4c000a0a4f0003bd010f0200090fec000d089e000f51000f0fec000e0b4f000f41010c0f4f001f0f51000a0f4f00210f5100080f4f00100a3d010302000f8f0103009a0201c0010f0200080341000102000030000f4a00030102000f4600080502000148000302000f5703010402000531000f02000a0349000202000f9e00070f44000a0202000243000b02000fa10001022f000f0200062bf90444000702000e4f000f47000600b6020004000fcd01020202000c8b010135000f020008001f01023a000f020003047a010102000f4800080302000f45000307020001480001020013f933000d02000319000735000f0200110336000e02000f2d01080f0200080f4f00fffffc0025040202000e5f03020200021e000202000f5603080202000f5c03060f0200010fbf030f0f4f00dd0ff000170f3c01d50f78023e0f39010f00c50e0faf02010f0200020f4f00620215010fb403080202001df9090b0f02000b0f7e020e0fed00120502000f4f005c0f9e04100802000f3d01060159011ff94e001c0fee00030f4800210302000f3d01010f7f011b0902000f4f009e1f003c0139120001000f4001240a3c01024b000002000f4f00300047000402000f4f002d0448000302000f4f002b0345000602000f4f00280645000602000f4f002606430008020018f90d0009f9020f020003032f000937000702000f1800000f480003064b000f0200230142000202000012010f450023070200024b000002000fc300000f02001f0049000202000f4f00800299000102000f9e002b007a010902000f4f00390f4e02030f020018079e000f3600180c020005e000064f000c23000f02001a055000040200073e00001300070f000f0200120034000802000335000005060f640322084c00054100010b00055c000f02001c003a000502000810000f48001c040200054c000a0200041f001ff985021d0a4700030200044500004801000200045e000b0200001b0001020007180006290206020003210001940100260b072f00080200043b0006140015f91400090200009f00066a09000e000f020001053b00071d0005140008020001c3000511000f4f000e0750000f4f00020a02000f4f000f0650000f4f003305f1000f4f003502a1000723010f0200060fed00100002000041010f9d00100f29020e040200002d05040c000f0200080f9e00140f0200150f4f00ffffb5008c030f0200020fa103110e02000f4b00020002000f4f003c0fb906040f02000c0038000f0200050f3b000c0f0200010f4b00050002000f3000010f02000b0036000f0200060f3b000b0f0200010f4b00060002000f3100010f02000b0036000f0200070f3c000b0f0200000f4b00070002000f3100000f02000b0035000f0200070f3c000b0f0200000f4b00070102000f3200000f0200090134000f0200080f3c00090f0200000f4a00080102000f3300000f0200090134000f0200080f3c00090f0200000f4a00080202000f3400000f0200080234000f0200080f3c00080e02000f4800080302000e34000f0200080334000f0200090f3e00080d02000f4800090302000d34000f0200080333000f0200090f3e00080c02000f4700090502000c35000f0200060532000f02000a0f3f00060c02000f46000a0602000c37000f0200050632000f02000a0f3f00050c02000f45000a0602000c37000f0200040631000f02000c0f4000040b02000f45000c0602000b38000f0200040630000f02000c0f4000040b02000f45000c0702000b39000f020002072f000f02000d0f4000020b02000f44000d0702000b3a000f020002072f000f02000e0f4100020a02000f44000e0702000a3a000f020001072d000f0200100f4200010902000f440010070200093b000f020001072c000f0200100f4200010902000f440010080200093c000e0200082b000f0200110e42000902000f430011080200093d000e0200082b000f0200120e43000802000f430012080200083d000e0200082a000f0200120e43000802000f430012080200083d000e0200082a000f0200120e43000802000f430012090200083e000d0200092a000f0200130d44000702000f420013090200073e000e02000176130f0200180f4f000c0f02001d19003100290103b90009020019130e00040200140109000c02000f2f00004c0100000227000402000c2f00500000000200'
    );

    expect(result.mapHeader).toEqual({
      mapHeaderStr: '01001200004f00c7019002da0005012c02e400003df80843',
      version: 1,
      id: 18,
      mapStable: false,
      mapWidth: 79,
      mapHeight: 199,
      originX: 40,
      originY: 73,
      mapResolution: 0.05,
      chargeX: 30,
      chargeY: 74,
      chargeDirection: undefined,
      chargePositionTransformed: { x: -10, y: 1 },
      dataLengthBeforeCompress: 15864,
      dataLengthAfterCompress: 2115,
    });

    expect(result.mapData.mapPointsStr.length).toBe(31442);
    expect(result.mapData.mapRooms).toEqual([
      {
        roomId: 0,
        pointHex: '00',
        name: '',
        order: 0,
        suction: 0,
        cistern: 0,
        colorOrder: 0,
        sweepTimes: 0,
        mopTimes: 0,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '0000000000000000000000000000000000000000000000000000130000000000000000000000000000000000000000',
        reservedStr: '0000000000000000000000',
      },
      {
        roomId: 1,
        pointHex: '04',
        name: '',
        order: 0,
        suction: 0,
        cistern: 0,
        colorOrder: 0,
        sweepTimes: 0,
        mopTimes: 0,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '0001000000000000000000000000000000000000000000000000130000000000000000000000000000000000000100',
        reservedStr: '0000000000000000000000',
      },
      {
        roomId: 2,
        pointHex: '08',
        name: '',
        order: 0,
        suction: 0,
        cistern: 0,
        colorOrder: 0,
        sweepTimes: 0,
        mopTimes: 0,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '0002000000000000000000000000000000000000000000000000130000000000000000000000000000000000000200',
        reservedStr: '0000000000000000000000',
      },
    ]);
  });

  test('chinese', () => {
    const result = decodeMap(
      '0156720100b5011a319c12020005025806540000c8ad116b1fff0100ff151f082801a11f08b600a01f08b500a05f08080808f921029d0fb500a100b4000f6a019e02b5000f20029b01b4000f8a039d00b2000fb400a30fb6007f0f92000900b0000002001fffd4027e0ff0060800b1000002000fa7057f0f94000700b0000202000fb6007d0fa6070802b1000f2100080f02004b0f0302081fff48010601b0000102000fd302621ff92e01080f1b000601af000202000fb500620f4e0107019c000007000e020002b0000102000fb500650f9b0005009d000006000d02000033000402000fb500671ff97b00032ff9f9b6000304b1000002000f3a00030f02004e017b0007b70012f90d000007000fd502030031000502000fb50068000200041e0104aa000014000616000602000016000602000618000f02005a04810004750000100001a1030102000416000502000116000702000f6b016304810003970000040500bc05031700031600060200031800040200014b020f02005f067f0002020004a9000318000b91000316000502000b1f000f020057058200210808680100980300bd000102000687000780010602000f1e026306bf0207020005b30005b5002008ff36020011000a02000fb500660090000f02000601d700098e010902000fb500ff3900ca020f8d01080f6a01670f20020e0fce02010202000fb500680fb600090069010fb5009e0020020fb500830f6b0108016a01020c020f0200000f1f02690f9700081f08f0040700880600d4000f0200660183000f0200020fd100090fb500860f02000a0f1f026a0f6b01090f0200090fb500ff220fbb020a0f0200060f6a016c0fb500a30fb600220f6a016d0fb500211f10b5006e0fb6000f1d1001000fb5006e026c0d0702000da3000e02000fb5006f0e94000f02000e0fb500ffffff451fff77030e0e02000f89036e0fb500a31ef94a010f02000d0f6a016f0fb500ff350fc901100f6a017f4ff914fff97f1f0c1ff9b6001f0f0b01100f02002950f9141414ff04000f4500070fb4001f0f9b0a4e131401000fb500980069010302000fb600060f6a01880fb600070fb500800f2102060062190202000f4b060d0e02000f89034c000200006701000200000c000602000f6101200502000fb5003c01270401050008020000b3000c43040fb500790051010da00022f9f9920308c9000fb5007711f9950501020007a10002b2000002000815001518ee010f02001e0f1f023c016701030200000e000002000367010202000011000102003ff91818b700260fb5003d029b00030200019e0007690100380202320420f9f9b5000fb600250fb50009001c003210101009000f02000500a707097c03019c0004020000360009b50001020032181818b5000f6d01240099000f02000325101043050f25000706a5000009000c57010002000fb500040502000fd1021e0f7c0807011c000502000fb500110f02000709d40201020005b2000102000567000f0200160f9000030b3f000f2500030202000efd010d02000d230001ac000602000b6e000f02000f0114030a02000db4000f0b0a0a0d92000f02001006b0000302000fa8000f0f02001f0f6a012c0d020003ab000702000f94001f0f02000e0fb5004f0fb700400fb500510fb405250f0200060fb500520f6d013d30f9f9ff6406020d1205a80e11103f040f8903320302000f3601060f02003303c0000f4e06010f02001003a4000f0200000f9e00330f02000c0f6a013b0fda02400f0200010fb5003e0f6d01510fb500400f47043e0d02001af9790a0f0200140051010f0200090d67000f02003c0fb5003601600b0402000fa5003c0c02000fb5003202b1000206000302000c68000f02003a01ac050002000f1a0214000200099e0006020004180c0202000fa6003a0a0200052c07008d000f0200150a9e0005020003830d0502000a6a000f020033005f010202000fad00150302000153100f6e01000d15000fa800330e020000b600038c000f02001400320000490702c40b05570107370e0702000e71000f02000c015c000f0200130fb000140002000951000a6f010a0e000202000fa4000c0202000954000f020017008f000f0200120a530009a700090d000602000298000a02000a9e120a54000f0200180fb200120cb40020fff9c90203a0000509000c02000ab0000002000f120e010fac00180402000fa00a14042f0004020009b5000cad0006020000a90008020003b3040813000202000458000f02001301b50000b31111140a000f0200070a4f000012020362010307000f02000302930004110b07680f0015000d02000a64000f02000801a70006ba110f02000600d40006470000b50003ea04010b000f02000705ab000366010602000db4000202000621000f02000704931609ae00022f000dac1110ff940201020001aa000efc040f0200010515020f02000002a7000c02000f2900000f02000507b600042300005e01010200040900005f0100cd0002130223f9f96d010f02000c0d640109020005b30002540d0183140f02000f016c01019c0002020006320004ac0005020000b50002150200020002bb000f02000f0fb5000b04b70000ca0e000e000306000f02000c064f17000200082d000fb500010f0200200fb5000d00a90001b5000f02001800ab000502000b38000518000202000fb20020009d010b55000f020030028f000102000c4e0010f98a190802000184000f02001e0f6a01100f02001d0704020c3b00041b0004bc0001af00000e070f02001b0fb500400492000cb20000ad07016601010b0007020001ef040f0200190fb500470796000f02000c0fb500760fa8000c0902000fb50072002f1a0f0200190fb500730f02001c0fb500ffffffffffff570f6406170f3109410f02001d0fae00170302000fb5007a0f240e350f020051056a010fb500ff5903b4020f02000d0fd4027203fa100f1e02150f8e0f410f02001e00d4020065120fb5009b00b60001b8000007000f0200100f1f0255056a14030200230000090000020002b50000b7000006000f02000f0fb5005609a600000f0007110004b5000f0200150fb50039083d010d0200200000710305170001b60004b8000fb5006a0485000f02000200a40001210011f90600002e0012000a000f63121e0f6a0138023d010fb1000201020001a500008e012200002b0000020030181818f1020f6c011b0fb50038008e00000200000a000f020002001d00330000f9640102020001c7020f8103150402000fb50039028700024e010b0200036700001e00000f020008000202000488000f02001a034e000f0200340289000db70010f90f0205ad000727000fb50072079000000d00010200009b0002020001bc000b02000f62011a0402000f6a013b000200059600010d000105000513000e02000388000fd6021b0fb5003f05ce040f02001205b5000f4004190fb50042066f01000c000002000fc1000604b5000fac051a0fb5004406a700000c000f7d01080fb5007b06b70003b9000009000e020004b5000fd5021a0f6a014600020005a400000d00070f0007020003b5000f4110190fb5004c061702060a000b02000084000102000f8903700702000ba6000b020001b1002f18ffb5007d0fb7000b0fb500830b5a010c020004b5001ff41f02770ca3000e0200009a0a0f1f02780ea10002020019f983082018ffb5000017100106000f0200130ff3044402a0000f02000209b400036a010fb500700fac00020502000cb500001c020fb5006d059d000f0200040ab40001b50001b6000f8903690fab00040f02000600b0000fb5006e0f3d0b0a00020000c50c07020000b5000102000f6a018a0fb500810f6a01060f1900040166010002000f6a01690b490106020008830f020200012b0000b0000102000fb5008103930f08020001480401b1000002000fb500690e5101001a020037090d1a000fb500780ebc0201b2000ab500011a020102000065010f02001e0fc7073d068f000302000367010ab5000602000fb1001e0002000fb5003d0b6b0101110003020000a01806ae000302000084000f02001e0fb500400221023aff00ffb4000002000d88011000a8110ff5101b00a808004c000f02003c02ad0000d5150c02000cb5000320000f3a04190002000f6a01400f53000809b50003b20000ee02008a000f0200180f6200080f02004005b5000a5c000f6a01700f02000802b5000d21000fb5001a310404040703100401000f7401511ff9e902010fb5001500a50005020012f90a000fb500510f0200040f6a010b029f000f0200030fb5006901f001000200098e030fa800030902000fb5006805020001730101bb00099b000f0200070fb50072006e010002000fa700070a02000fb500710402000fb600160fb500790fb600160fb5007b0a06020f0200060fb500ffff9c00f80403ab070f0200090fd4027a0102000fb500ffffffffffffffffffff910f480b090402000f500b7e0f920f110fb5007f044f010f0200080fb5009c01900d07b02f0f0200740f6e0d0700ae000f64017e0202000fb500080221000f0200810fb500080f6701840ff3040b0fb500860f3404080f2002860fb400090fb500840fb3000a0f1f02830098000f02000a0fd4027e100c01000fb3000a0fb5007d00b100030200009d000f0200050f6a017803ae000602000fb400050f89037806ad000602000eb70001c3070f6a017306a7000d02000ab8000f2309770da9000b020008b8000f6501741bffa3000f02000106b7000fb500720fa300010f02000203b8000fb500700f9f00020f02000600b8000fb5006d0f9d00060f0200070fb5006c0f9900070f02000b0f6a01680f99000b0f02000a016c0b0f0200601ff9960007003c060f1e00070102000fb100600002000fb50008200cf9f91c019d000f0200060043000f02005e0f8e00060490000fb6007f009c000f0200050340010f8a01090102000328000f0200550174000f02000504850000d9020fb9000a0429000f0200521ff9b3070302a1000a82000214000f0200040ff8045a0a8a000073030712000fb500070da1010fb5006611ffa600067403000e000702000764010a0e000002000fb5005b055901059f000e1200030200009d0002020000b5000a58020fb5005a02a30012ff65010202000112000115000a02000a83010fb5006d0a9c0002c7000d160000190008cf000fb5006b019000080200029b00081200030200056b010010000fb5006a0d0200029b000d170000c702008101000200000e000fb5007b0096000147040c02000119000002000119000fb5007a0096000fb400020a6901000200012b000302000f3e045b0b02000184000b1400020200011a00000200020f0008c600010b0a0113000f0200630182000f7b0002011a00010200041f00010d000302000fb50069018300049500090200025404010200041800010d000302000fb5006916ff93000b020005b50007880603b1000002000fb500690f7c000706b50007ce0000af000302000716000f0200770fb500a205f2040948010367010002000918000f0200740098000102000890000111000302000818000f0200760f9c00010817070fa9007607020003b4000988030a550b072d000f02007410f9ec0400b900099000086a010acf000f02007222f90c6d010c8d0000c8000402000c1c000f02006e13f955010c890003b1000163100c1c000f02006e00760600a1000d89000015000f31096d0f020008019d000d20000116000f1800000f020073009b000f9d00000015000f1700000f02007501d6020d8d0000b3000f30096b0f02000c0fd8040200b400100cf3020f0200840fb500a20f6e0b02016a010f5a06800602000f9d000001b5000622000f0200800fb500000fde07000f0200900088030f8903880f0200030ff1048a0f0200050f87038c0f0200040f6b01a40fce00040f0200890fb500a30f5201890f0200ffffffffffffffffffffffffffffffffa621010735588101000100000002020d000402007406e5a4a7e997a80f000302000029004d010001012f0083076162636465666728000302000053004d010001022f007306e998b3e58fb0270004020012032f001e032f0064e6b5b4e5aea4280003020012042f001e042f003ee58da72f0012052f001f052f0000538ea8e688bf560004020012062f001d062f004403313233250090000000000000000000'
    );

    expect(result.mapData.mapRooms).toEqual([
      {
        roomId: 0,
        pointHex: '00',
        name: '大门',
        order: 0,
        suction: 2,
        cistern: 2,
        colorOrder: 0,
        sweepTimes: 1,
        mopTimes: 1,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '000000000001000100000002020000000000000000000000000006e5a4a7e997a80000000000000000000000000000',
        reservedStr: '0000000000000000000000',
      },
      {
        roomId: 1,
        pointHex: '04',
        name: 'abcdefg',
        order: 0,
        suction: 2,
        cistern: 2,
        colorOrder: 1,
        sweepTimes: 1,
        mopTimes: 1,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '0001000000010001010000020200000000000000000000000000076162636465666700000000000000000000000000',
        reservedStr: '0000000000000000000000',
      },
      {
        roomId: 2,
        pointHex: '08',
        name: '阳台',
        order: 0,
        suction: 2,
        cistern: 2,
        colorOrder: 2,
        sweepTimes: 1,
        mopTimes: 1,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '000200000001000102000002020000000000000000000000000006e998b3e58fb00000000000000000000000000000',
        reservedStr: '0000000000000000000000',
      },
      {
        roomId: 3,
        pointHex: '0c',
        name: '浴室',
        order: 0,
        suction: 2,
        cistern: 2,
        colorOrder: 3,
        sweepTimes: 1,
        mopTimes: 1,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '000300000001000103000002020000000000000000000000000006e6b5b4e5aea40000000000000000000000000000',
        reservedStr: '0000000000000000000000',
      },
      {
        roomId: 4,
        pointHex: '10',
        name: '卧室',
        order: 0,
        suction: 2,
        cistern: 2,
        colorOrder: 4,
        sweepTimes: 1,
        mopTimes: 1,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '000400000001000104000002020000000000000000000000000006e58da7e5aea40000000000000000000000000000',
        reservedStr: '0000000000000000000000',
      },
      {
        roomId: 5,
        pointHex: '14',
        name: '厨房',
        order: 0,
        suction: 2,
        cistern: 2,
        colorOrder: 5,
        sweepTimes: 1,
        mopTimes: 1,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '000500000001000105000002020000000000000000000000000006e58ea8e688bf0000000000000000000000000000',
        reservedStr: '0000000000000000000000',
      },
      {
        roomId: 6,
        pointHex: '18',
        name: '123',
        order: 0,
        suction: 2,
        cistern: 2,
        colorOrder: 6,
        sweepTimes: 1,
        mopTimes: 1,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '0006000000010001060000020200000000000000000000000000033132330000000000000000000000000000000000',
        reservedStr: '0000000000000000000000',
      },
    ]);
  });
});

describe('decodeMapV2', () => {
  test('basic usage', () => {
    const result = decodeMap(
      '0200030100a6009c05cf03070005061e030e0000682b06aa1f000100ffffffffffffffffffffffffffffffffffffffffffffffffe6110101000fe7188a00a2004f07070707a6002d0048000f0200050f5b002c31000000a3000fa600310146000f0200020f01012d0fa600ffffa701b50301bf020f02000e0486030f0200000f3e033102890411079100090200035b030f6400140fa6004a0098000fff000000b70004a6000fa700130049000faa00040f4100130f0200090f59000407a60001af000f02000f00a6000138000e02000fa6002c0f5a00080303020509000f02000f002b000f0200030fa6002b0f5a00090044010f6801070e02000f2c00090fa6002c0e6d000f0200420fa600ffffffff850f9404210f8a05090f020039069c000fc206000f7c070e0fa600600dfd0006c2000f0200050fa600ff190705020f4e01030f4c01710702000ffd01040fa6004d046000067f00051200079d000502000756010632000634000f020045059400006d000102000312000f330a0c0021000402000534000f02004603940008a6000fa0000e0b02000fa6005004020006c00104b8000f0200162f0101be04000f02004200b7010302000fa6001e0004040f9500420e02000f4c01010f710e060f0200660da6000f53011f0f0200500fa600ff4c0ff301810df2010f7c06030f02006c0ea6000f0200800f30052a0f020056064b010f4806550f0200210f4c0193086e080fe600210f02005406f3010618070f9f07560f02001607a6000f3400160f02005f0fa600ffffff1904fb0d0a020003500c098a040fc5035f06020006cf030f0200020730050634000f02005f0fa6000d0f92005f0f0200010fa600ffffd50fc50d450f3e033b0a76050f0200130fd403010c02000fa6003c0f7505020f02000a057f012c17179c000612000fa6000d0f1001130502000f91000a0f020002053b002c01170100161101001f100100590677000f0200000ca500151724000ca3000119000c15000f0200370e8a000002000216000206000802000412001c1181000019000d15000f020037005f000e02000f160003060200013b01010200111006000177010fa6005e0f02001602a0000202000fa600870602000f9802600f0200210fa7004807b1010f02002f0f4e01460f27030d0f02001b0f9a02440f4b013a0fa60047005c000f0200370f4c01450fa200370002000fa600ffffff2a0073080f3e038f0fa200440002000f7b06370f1e07460fa6003b0150000f0200430f4c01150f28000f0ff101480f7c06150fef07100fa600f01f0f010012200909a6070f02000a0f4c014a0fa500123f0f090928000e2f09080100470f7e000f0102000fa6009401ac000f02000a0f4c01710fa1000a0102000fa600700f0200100fa600ffffff2f0f3f03480fd605140f0200111f09a800470fa600380f8d04480fa600ff730f8008000f9802800ea6000fa500470f9802270da6000fa5004803a6000fac00202a0909a8000fa5004903a6000f0200201a093b000fa5004a0a6b000f0200190aa6000fa5004b0fa600340fa5004c0fa6002a05ce020fa5004d1b0804030f020017250908a7000fa5004e02a8000f020022073b000148000f0200ffffffffffff7c2101034f2520010075251a03c7257106726f6f6d203121000402005151ffe8fff6040011e70400f100f7ffe0fff7ffdffff7ffcffff7ffce0400f508f6ffb7fff6ffb70007ffb80008ffb90008ffba0007ffc004007306ffc40006ffc50400d3c60005ffca0005ffcb0004ffcf040091d00003ffd10003ffd20400350dffd30400350effd404007312ffd50012ffd80400f116dc0012ffdd0011ffdd0010ffdc000fffda000fffd90010ffd80010ffd7000fffd8000effe00400510dffe1000c040091e2000dffe2000effe30400f1000fffe5000fffe7000dfff5000dfff60400710efff9000efffa0800310ffff80400b112000400120004fffcfffb040000020093f7fffafff6fff7fff60600d1f7fff5fff6ffeefff6ffedfff7040052ecfff6ffe93c011000680170010001020000020b0006020002730116321100a500000022ffdeffddffde020032eafff104002100040400f104e90002ffe90001ffe80001ffe60002ffe50003040093e30000ffe10000ffe0040013df0400b1defffeffdefffdffdefffc040013df040071e0fffbffe1fffa040075e0fffaffdefff1040000800030dd0002c334100033020fb700021133af00040200132aa70031ebffde040013f3040071f6ffdffff6ffe03e0200420200040011f5040015ed040015f60400004201004a010a020000120011f56401d1f7fff50002fff50003fff50004040035ee0003040031ed0004040071ec0003ffec0002080011eb0400b004ffeb0004ffeafff1ffea'
    );

    expect(result.mapHeader).toEqual({
      mapHeaderStr: '0200030100a6009c05cf03070005061e030e0000682b06aa',
      version: 2,
      id: 3,
      mapStable: true,
      mapWidth: 166,
      mapHeight: 156,
      originX: 148.7,
      originY: 77.5,
      mapResolution: 0.05,
      chargeX: 156.6,
      chargeY: 78.2,
      chargePositionTransformed: { x: 7.900000000000006, y: 0.7000000000000028 },
      dataLengthBeforeCompress: 26667,
      dataLengthAfterCompress: 1706,
    });

    expect(result.mapData.mapPointsStr.length).toBe(51792);
    expect(result.mapData.mapRooms).toEqual([
      {
        roomId: 0,
        pointHex: '07',
        name: 'room 1',
        order: 0,
        colorOrder: 1,
        suction: 3,
        cistern: 1,
        sweepTimes: 1,
        mopTimes: 1,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '000000000001000101000003010000000000000000000000000006726f6f6d20310000000000000000000000000051',
        reservedStr: '0000000000000000000000',
      },
      {
        roomId: 1,
        pointHex: '0f',
        name: 'room 2',
        order: 0,
        colorOrder: 2,
        suction: 2,
        cistern: 1,
        sweepTimes: 1,
        mopTimes: 1,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '000100000001000102000002010000000000000000000000000006726f6f6d20320000000000000000000000000022',
        reservedStr: '0000000000000000000000',
      },
      {
        roomId: 2,
        pointHex: '17',
        name: 'room 3',
        order: 0,
        colorOrder: 3,
        suction: 2,
        cistern: 1,
        sweepTimes: 1,
        mopTimes: 1,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '000200000001000103000002010000000000000000000000000006726f6f6d2033000000000000000000000000002a',
        reservedStr: '0000000000000000000000',
      },
    ]);
  });
});

describe('decodeMapV3', () => {
  test('basic usage', () => {
    const result = decodeMap(
      '0300030100b8007303bf0272000503e6041f00e10000570c0ab61f000100ff4b4f0f0f0f080100a01f0fb800a200b6000f7001a000b5000002000f28029c00b3000202000fb9009902b2000202000fb8009802b1000302000fb8009603b00004020000b800000c000008000f02008900a4000802000612000fb600891808b3000b02000fb800880baa000a02000fb800870aa8000c02000fb800850ca8000c02000fb800840ca7000b02000fb600840f9103090fb500870fb600a40fb700090f200285000200000b020f020002001d000f0200860fb200020002000fb2008601020000a2000f020000011c000f0200870fb200000f9f0d9001a5000d02000f6601870402000db3000fb500ff470fb305010486010f0200890013020902000fad008905020009b2000f40049002020001ab000702000216000f0200151f090100010f3d00150f02002807b1000002000f4a001e2e090701004f01000001ab151f0f33001a00ac0005020003b5000f2a021a0fb800054f0101efe901000e18e801000f2e000e06300005b20000020002b600000a00320f0f090d000f0200100fb800052eefef8801040200130109001a0101000316000d0200009100010200038f00010c00040200001400040c000fb8004d0f02001c00910001020000a40008a6000e02000020000f0200130f70010424000055010f02002f059f00009200050d000f0200020022000f0200130fb800062f0000b2002f02020004a2000f1f07030702000fb200130202000fb8000015011a040fb402070f020019130a9b000fd50701060200028f000f0200160fb80001006d010102000fb800317602020a0f090909a1000f0200010faf00160502000eb800066f010fe402315f0202020f0fb9000b058c000f0200190fb80000016b010102000f9c032e1002010000b8001f087201050fac00190802000db80026efe94d061fe9c702190f02000000b60002b8000f2a0206088c000f0200190db8000727020f28022c00b400400202020770010fe002060fac00190802000eb8000122020102000f97032b01b5000fb80056076f010fde022c01b5000fb80008083e010f02001f0c700105bc050fb8002e1107b600160278060d02000fae001f0602000fb800070f26022b0fb80011000200068a000f02001b0bb8000f6f0138032a020f7001080302000fb1001b0302000fb800520f060506050200038e000f0200170ab8000896030f97032c032902100770010f7706070802000fb500170eb8000090030202001f01390c080f02001501970301b8000f0c0a0e0302000194000f0200110b700102b4000073060fb8000f0f91010f09b8000f0f0a0b0702000fb700110cb8000529020fa90d0a0f02000f03d40011027c02045500079c000f02000d0fbc000e0ab800006700016f010fe3072c0fb8002e0302000fbf00070eb8000020011f01bd052e090200045e05038e000f02001d0fbe00010db8000102000fb7003b04c4010fb900260fbb00000fb800030f02003c0470010fb900270d73010fb8005c10003d010f02000804a2060cf80a014a050802000fb8005d0fb9000c042f050c350508b3000102000fb8005e09b9000c5515009300016b010fb8004903ec040f02001006e0020002000727020dff010602000726000ff114010f7001290f7604160ab8000772010fb800080f02000c0fb800e10f0200160b70010671010f7001630f0200160cb80005b9000fb8009d04b9000fc5020c0f0200080fe002290f0200160d70010455040f9900080f02000c0fb8001404f4040b43040f1700040c02000fb800000372010f9e000c0f02000701b8000132100c6d000f0200380fb8000102b9000f9900070f02000c0fb8006701b9000f9e000c0f02000706b800009c0c0f0200440f7001020fb800a600b9000f5101070f02000c0170010213130f6d014408380c0f0200370212040199030f2902470f2802030f02002a0fb800ff6a0f29021102a0010302000686060917000d02000f28024c0fb800110f0200040fb800a50f02000b0f7001460209050f0b05460fb800ff2908c902080c000f02000805d8140f020039037c000025020002000f7f0008020200073a14070b000f0200090fb600410fb8001f07660103f3000f02000d0fdd0240063016006c010002000f85000d0f0200200fb8004a0451040fc305280f0200050fb800a60f9803490f7001480fc80a4906e1020f2902400f2b02420615040097030fb800a103ba000009000f02003d0f9b03400670010002000072010008000f02000904320006c50a0f02000e0fb8004e00ba000006000f0200090fb8001108d400009e1b012b060f02003a0486000f02003b0fb800a50a0200086b260f0200350fb3262d0f0200110fb800a506781d0f0200370fe002430b02000f5004500f0200420fb800ffd5003a060d02000f5102190f2802640f7700010fd003190f3007650fb8002e0fff04370502000f3801110fb8002c0f6f01410f4825120fb8002b0fb700420fb8004f0fb700430fb8004e0fb700440fb8004d0fb700450fb8003f097e130fb700460fb800270f8904042701011b000fb7004700b1380f02000f0536050702000f320704007c0404d3000f3900030f02006d0fef0004080c010fa3006d0f0200ffed21010201020002043000000252030602007606726f6f6d20311100e100000054ffd3000fffd3ffe9ffe4040051edffe5ffee0200d1efffedffefffe9fff0ffe8fffa0400f110e9fffbffeafffcffeafffdffe9fffdffe80000ffe80003ffec0003ffed0004040031f00003040011f104001102040071f20003fff200040400f004f40003fff40002fff50002fff70003fff8000404008100040003000400020400310500030400330efff8040093f1000efff0000effed040051ec000effe00400110d040011e20400130c0400750bffe20009ffe10400f30008ffe00007ffe00005ffe00004ffdf040031de0003040051dd0003ffdb040011040400f300da0004ffd90005ffd90006ffda000704007108ffda0009ffdb0400f1000affdc000bffdc000cffdc000dffdd0400300fffdc480121000f7f3e110188010f7f010211327701040200f10aad0023001e0022001d0021001d0020001b001f001b001e001a0400311c00190400f10c1b0018001a00180019001600180016001700150016001500150014040035140013040035130012020071110012001000110400310f00100400130e0400510d000f000c0400910e000b000e000a000d0400130904003108000c040015070400130d0400310e0003040031050004040011070400f1000500070008000500080004000c00000400310ffffd04005110fffc00110400f500fe0010ffff0010000100110002001904009303001a0003001b000204003101001d0400d102001d0003001e0002001e0001040011250400f1040300240003002300040021000400200004001d04003305001b04001119040033060017040011150400330700130400d31200070011000800100008000f0400910e0009000f000900110400710b0012000b00130400b10c0014000c0015000c00160400750d0017000d00180400330f00170400f10616000f0015000e0014000e0013000e0012000e00110800110f04001313040053140010001504007116001000170011040051180011001904007312001a0012001b0400531c0013001d0400711e0013001f0014040051200014002104007315002200150023040053240016002504007126001600270017040051280017002904003118002a0400331a002904001327040011260400311900250400f0021a0025001c0024001d0024001e0023001e'
    );

    expect(result.mapHeader).toEqual({
      mapHeaderStr: '0300030100b8007303bf0272000503e6041f00e10000570c0ab6',
      version: 3,
      id: 3,
      mapStable: true,
      mapWidth: 184,
      mapHeight: 115,
      originX: 95.9,
      originY: 62.6,
      mapResolution: 0.05,
      chargeX: 99.8,
      chargeY: 105.5,
      chargeDirection: 225,
      chargePositionTransformed: { x: 3.8999999999999915, y: 42.9 },
      dataLengthBeforeCompress: 22284,
      dataLengthAfterCompress: 2742,
    });

    expect(result.mapData.mapPointsStr.length).toBe(42320);
    expect(result.mapData.mapRooms).toEqual([
      {
        roomId: 0,
        pointHex: '07',
        name: 'room 1',
        order: 0,
        colorOrder: 1,
        suction: 2,
        cistern: 1,
        sweepTimes: 1,
        mopTimes: 1,
        sweepForbidden: false,
        mopForbidden: false,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '000000000001000101000002010000000000000000000000000006726f6f6d20310000000000000000000000000054',
        reservedStr: '0000000000000000000000',
      },
      {
        cistern: 1,
        colorOrder: 2,
        mopForbidden: false,
        mopTimes: 1,
        name: 'room 2',
        order: 0,
        pointHex: '0f',
        roomId: 1,
        suction: 2,
        sweepForbidden: false,
        sweepTimes: 1,
        yMop: false,
        floorMaterial: 0,
        originStr:
          '000100000001000102000002010000000000000000000000000006726f6f6d203200000000000000000000000000ad',
        reservedStr: '0000000000000000000000',
      },
    ]);
  });
});

describe('decodeMapStructured', () => {
  test('empty map', () => {
    const result = decodeMapStructured(
      '7b226964223a302c22737461747573223a302c227265736f6c7574696f6e223a302c2273697a65223a5b302c305d2c226f726967696e223a5b302c305d2c2263686172676572223a7b22636f6f7264696e617465223a5b302c305d2c22616e676c65223a307d7d'
    );

    expect(result).toEqual({
      id: 0,
      status: 0,
      resolution: 0,
      size: [0, 0],
      origin: [0, 0],
      charger: { coordinate: [0, 0], angle: 0 },
    });
  });
});
