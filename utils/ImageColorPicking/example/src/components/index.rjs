// ../src/components/color.js
var limit = (number, min, max) => Math.min(max, Math.max(min, number));
function hsv2rgb() {
  let h = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : 0;
  let s = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : 0;
  let v = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : 0;
  let a = arguments.length > 3 ? arguments[3] : void 0;
  const hsb = [h, s, v].map((bit, i) => {
    let _bit = bit;
    if (_bit)
      _bit = parseFloat(_bit.toString());
    if (i === 0) {
      _bit %= 360;
      const res = _bit < 0 ? _bit + 360 : _bit;
      return res;
    }
    return limit(Math.round(bit), 0, 100);
  });
  const br = Math.round(hsb[2] / 100 * 255);
  if (hsb[1] === 0)
    return [br, br, br];
  const hue = hsb[0];
  const f = hue % 60;
  const p = Math.round(hsb[2] * (100 - hsb[1]) / 1e4 * 255);
  const q = Math.round(hsb[2] * (6e3 - hsb[1] * f) / 6e5 * 255);
  const t = Math.round(hsb[2] * (6e3 - hsb[1] * (60 - f)) / 6e5 * 255);
  let rgb;
  switch (Math.floor(hue / 60)) {
    case 0:
      rgb = [br, t, p];
      break;
    case 1:
      rgb = [q, br, p];
      break;
    case 2:
      rgb = [p, br, t];
      break;
    case 3:
      rgb = [p, q, br];
      break;
    case 4:
      rgb = [t, p, br];
      break;
    default:
      rgb = [br, p, q];
      break;
  }
  if (a !== void 0) {
    rgb.push(limit(Number(a), 0, 1));
  }
  return rgb;
}
function rgb2hsv() {
  let r = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : 0;
  let g = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : 0;
  let b = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : 0;
  let red = parseFloat(r.toString());
  let green = parseFloat(g.toString());
  let blue = parseFloat(b.toString());
  if (red < 0)
    red = 0;
  if (green < 0)
    green = 0;
  if (blue < 0)
    blue = 0;
  if (red > 255)
    red = 255;
  if (green > 255)
    green = 255;
  if (blue > 255)
    blue = 255;
  red /= 255;
  green /= 255;
  blue /= 255;
  const M = Math.max(red, green, blue);
  const m = Math.min(red, green, blue);
  const C = M - m;
  let h;
  let s;
  let v;
  if (C === 0)
    h = 0;
  else if (M === red)
    h = (green - blue) / C % 6;
  else if (M === green)
    h = (blue - red) / C + 2;
  else
    h = (red - green) / C + 4;
  h *= 60;
  if (h < 0)
    h += 360;
  v = M;
  if (C === 0)
    s = 0;
  else
    s = C / v;
  s *= 100;
  v *= 100;
  return [h, s, v];
}

// ../src/components/utils.js
function extractColors(pixels, numColors) {
  const pre = Math.round(pixels.length / 278e3);
  const sampleFrequency = Math.max(1, pre);
  let data = [];
  for (let i = 0; i < pixels.length; i += sampleFrequency) {
    data.push({ r: pixels[i], g: pixels[i + 1], b: pixels[i + 2] });
  }
  const colors = kmeans(data, numColors);
  const maxSColors = colors.map((item) => {
    const rgb = item.replace("rgba(", "").replace("rgb(", "").replace(")", "").split(",").map((lit) => Number(lit.trim()));
    const hsv = rgb2hsv(...rgb);
    console.log(hsv, "--hsv");
    const color = hsv2rgb(isNaN(hsv.h) ? 0 : hsv.h, hsv.s, hsv.v > 0.4 ? hsv.v + 0.15 : 0.4);
    return `rgb(${color.r}, ${color.g}, ${color.b})`;
  });
  return maxSColors;
}
function kmeans(data, k) {
  const centroids = initializeCentroids(data, k);
  let clusters = new Array(k);
  let oldCentroids;
  let changed = true;
  while (changed) {
    clusters = Array.from({ length: k }, () => []);
    data.forEach((point) => {
      let closestCentroidIndex = -1;
      let minDistance = Infinity;
      centroids.forEach((centroid, index) => {
        const distance = euclideanDistance(point, centroid);
        if (distance < minDistance) {
          closestCentroidIndex = index;
          minDistance = distance;
        }
      });
      clusters[closestCentroidIndex].push(point);
    });
    oldCentroids = centroids.slice();
    centroids.forEach((centroid, index) => {
      if (clusters[index].length > 0) {
        const mean = calculateMean(clusters[index]);
        centroids[index] = mean;
      }
    });
    changed = !centroidsEqual(oldCentroids, centroids);
  }
  return centroids.map((centroid) => `rgb(${centroid.r}, ${centroid.g}, ${centroid.b})`);
}
function initializeCentroids(data, k) {
  const centroids = [];
  for (let i = 0; i < k; i++) {
    const randIndex = Math.floor(Math.random() * data.length);
    centroids.push({ ...data[randIndex] });
  }
  return centroids;
}
function euclideanDistance(a, b) {
  return Math.sqrt((a.r - b.r) ** 2 + (a.g - b.g) ** 2 + (a.b - b.b) ** 2);
}
function calculateMean(cluster) {
  let r = 0;
  let g = 0;
  let b = 0;
  cluster.forEach((point) => {
    r += point.r;
    g += point.g;
    b += point.b;
  });
  const { length } = cluster;
  return { r: Math.round(r / length), g: Math.round(g / length), b: Math.round(b / length) };
}
function centroidsEqual(oldCentroids, newCentroids) {
  for (let i = 0; i < oldCentroids.length; i++) {
    if (oldCentroids[i].r !== newCentroids[i].r || oldCentroids[i].g !== newCentroids[i].g || oldCentroids[i].b !== newCentroids[i].b) {
      return false;
    }
  }
  return true;
}

// ../src/components/index.rjs
var components_default = Render({
  ctx: null,
  canvas: null,
  preId: "",
  /**
   * @name: 渲染灯带动画
   * @desc:
   * @param {*} props
   * @return {*}
   */
  async renderLight({ src, canvasId, pickNum }) {
    if (!src)
      return;
    if (!this.ctx || this.preId !== canvasId) {
      console.log("\u{1F680} get the Canvas ctx");
      this.canvas = await getCanvasById(canvasId);
      this.ctx = this.canvas.getContext("2d");
      this.preId = canvasId;
    }
    this.getImage(src, pickNum);
  },
  getImage(src, pickNum) {
    const img = this.canvas.createImage();
    img.onload = () => {
      const width = img.width;
      const height = img.height;
      this.canvas.width = width;
      this.canvas.height = height;
      this.ctx.drawImage(img, 0, 0, width, height);
      const imageData = this.ctx.getImageData(0, 0, width, height);
      const pixels = imageData.data;
      const colors = extractColors(pixels, pickNum);
      this.callMethod("getColors", {
        colors
      });
    };
    img.onerror = (e) => {
      console.log("\u274Crjs img.onerror", e, e.message);
    };
    img.src = src;
  }
});
export {
  components_default as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvY29sb3IuanMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvdXRpbHMuanMiLCAiLi4vLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2NvbXBvbmVudHMvaW5kZXgucmpzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvKlxuICogQEF1dGhvcjogbWpoXG4gKiBARGF0ZTogMjAyNS0wMS0wMiAxODoyODo0OVxuICogQExhc3RFZGl0b3JzOiBtamhcbiAqIEBMYXN0RWRpdFRpbWU6IDIwMjUtMDEtMDIgMTg6Mjk6MDFcbiAqIEBEZXNjcmlwdGlvbjpcbiAqL1xuY29uc3QgbGltaXQgPSAobnVtYmVyLCBtaW4sIG1heCkgPT4gTWF0aC5taW4obWF4LCBNYXRoLm1heChtaW4sIG51bWJlcikpO1xuXG5leHBvcnQgZnVuY3Rpb24gaHN2MnJnYigpIHtcbiAgbGV0IGggPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDA7XG4gIGxldCBzID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiAwO1xuICBsZXQgdiA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogMDtcbiAgbGV0IGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMyA/IGFyZ3VtZW50c1szXSA6IHVuZGVmaW5lZDtcbiAgY29uc3QgaHNiID0gW2gsIHMsIHZdLm1hcCgoYml0LCBpKSA9PiB7XG4gICAgbGV0IF9iaXQgPSBiaXQ7XG4gICAgaWYgKF9iaXQpIF9iaXQgPSBwYXJzZUZsb2F0KF9iaXQudG9TdHJpbmcoKSk7XG4gICAgaWYgKGkgPT09IDApIHtcbiAgICAgIF9iaXQgJT0gMzYwO1xuICAgICAgY29uc3QgcmVzID0gX2JpdCA8IDAgPyBfYml0ICsgMzYwIDogX2JpdDtcbiAgICAgIHJldHVybiByZXM7XG4gICAgfVxuICAgIHJldHVybiBsaW1pdChNYXRoLnJvdW5kKGJpdCksIDAsIDEwMCk7XG4gIH0pO1xuICBjb25zdCBiciA9IE1hdGgucm91bmQoKGhzYlsyXSAvIDEwMCkgKiAyNTUpO1xuICBpZiAoaHNiWzFdID09PSAwKSByZXR1cm4gW2JyLCBiciwgYnJdO1xuICBjb25zdCBodWUgPSBoc2JbMF07XG4gIGNvbnN0IGYgPSBodWUgJSA2MDtcbiAgY29uc3QgcCA9IE1hdGgucm91bmQoKChoc2JbMl0gKiAoMTAwIC0gaHNiWzFdKSkgLyAxMDAwMCkgKiAyNTUpO1xuICBjb25zdCBxID0gTWF0aC5yb3VuZCgoKGhzYlsyXSAqICg2MDAwIC0gaHNiWzFdICogZikpIC8gNjAwMDAwKSAqIDI1NSk7XG4gIGNvbnN0IHQgPSBNYXRoLnJvdW5kKCgoaHNiWzJdICogKDYwMDAgLSBoc2JbMV0gKiAoNjAgLSBmKSkpIC8gNjAwMDAwKSAqIDI1NSk7XG4gIGxldCByZ2I7XG4gIHN3aXRjaCAoTWF0aC5mbG9vcihodWUgLyA2MCkpIHtcbiAgICBjYXNlIDA6XG4gICAgICByZ2IgPSBbYnIsIHQsIHBdO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAxOlxuICAgICAgcmdiID0gW3EsIGJyLCBwXTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMjpcbiAgICAgIHJnYiA9IFtwLCBiciwgdF07XG4gICAgICBicmVhaztcbiAgICBjYXNlIDM6XG4gICAgICByZ2IgPSBbcCwgcSwgYnJdO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSA0OlxuICAgICAgcmdiID0gW3QsIHAsIGJyXTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZ2IgPSBbYnIsIHAsIHFdO1xuICAgICAgYnJlYWs7XG4gIH1cbiAgaWYgKGEgIT09IHVuZGVmaW5lZCkge1xuICAgIHJnYi5wdXNoKGxpbWl0KE51bWJlcihhKSwgMCwgMSkpO1xuICB9XG4gIHJldHVybiByZ2I7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZ2IyaHN2KCkge1xuICBsZXQgciA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogMDtcbiAgbGV0IGcgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDA7XG4gIGxldCBiID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAwO1xuICBsZXQgcmVkID0gcGFyc2VGbG9hdChyLnRvU3RyaW5nKCkpO1xuICBsZXQgZ3JlZW4gPSBwYXJzZUZsb2F0KGcudG9TdHJpbmcoKSk7XG4gIGxldCBibHVlID0gcGFyc2VGbG9hdChiLnRvU3RyaW5nKCkpO1xuICBpZiAocmVkIDwgMCkgcmVkID0gMDtcbiAgaWYgKGdyZWVuIDwgMCkgZ3JlZW4gPSAwO1xuICBpZiAoYmx1ZSA8IDApIGJsdWUgPSAwO1xuICBpZiAocmVkID4gMjU1KSByZWQgPSAyNTU7XG4gIGlmIChncmVlbiA+IDI1NSkgZ3JlZW4gPSAyNTU7XG4gIGlmIChibHVlID4gMjU1KSBibHVlID0gMjU1O1xuICByZWQgLz0gMjU1O1xuICBncmVlbiAvPSAyNTU7XG4gIGJsdWUgLz0gMjU1O1xuICBjb25zdCBNID0gTWF0aC5tYXgocmVkLCBncmVlbiwgYmx1ZSk7XG4gIGNvbnN0IG0gPSBNYXRoLm1pbihyZWQsIGdyZWVuLCBibHVlKTtcbiAgY29uc3QgQyA9IE0gLSBtO1xuICBsZXQgaDtcbiAgbGV0IHM7XG4gIGxldCB2O1xuICBpZiAoQyA9PT0gMCkgaCA9IDA7XG4gIGVsc2UgaWYgKE0gPT09IHJlZCkgaCA9ICgoZ3JlZW4gLSBibHVlKSAvIEMpICUgNjtcbiAgZWxzZSBpZiAoTSA9PT0gZ3JlZW4pIGggPSAoYmx1ZSAtIHJlZCkgLyBDICsgMjtcbiAgZWxzZSBoID0gKHJlZCAtIGdyZWVuKSAvIEMgKyA0O1xuICBoICo9IDYwO1xuICBpZiAoaCA8IDApIGggKz0gMzYwO1xuICB2ID0gTTtcbiAgaWYgKEMgPT09IDApIHMgPSAwO1xuICBlbHNlIHMgPSBDIC8gdjtcbiAgcyAqPSAxMDA7XG4gIHYgKj0gMTAwO1xuICByZXR1cm4gW2gsIHMsIHZdO1xufVxuIiwgIi8qIGVzbGludC1kaXNhYmxlIG5vLWxvb3AtZnVuYyAqL1xuaW1wb3J0IHsgaHN2MnJnYiwgcmdiMmhzdiB9IGZyb20gJy4vY29sb3InO1xuLyoqXG4gKiBAbmFtZTogXHU4M0I3XHU1M0Q2XHU1MENGXHU3RDIwXHU3MEI5XHU5ODlDXHU4MjcyXG4gKiBAZGVzYzpcbiAqIEBwYXJhbSB7Kn0gcGl4ZWxzIFx1NjI0MFx1NjcwOVx1NTBDRlx1N0QyMFx1NzBCOVxuICogQHBhcmFtIHsqfSBudW1Db2xvcnMgXHU2M0QwXHU1M0Q2XHU3Njg0XHU5ODlDXHU4MjcyXHU2NTcwXHU5MUNGXG4gKiBAcGFyYW0geyp9IHNhbXBsZUZyZXF1ZW5jeSBcdTZCQ0ZcdTUzRDZcdTRFMDBcdTZCMjFcdThERjNcdThGQzdcdTc2ODRcdTUwQ0ZcdTdEMjBcdTcwQjlcdTY1NzAgIFx1NjU3MFx1NUI1N1x1OEQ4QVx1NTkyN1x1NjAyN1x1ODBGRFx1OEQ4QVx1NTk3RFxuICogQHJldHVybiB7Kn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGV4dHJhY3RDb2xvcnMocGl4ZWxzLCBudW1Db2xvcnMpIHtcbiAgLy8gXHU2NTM2XHU5NkM2XHU5MUM3XHU2ODM3XHU3MEI5XG4gIGNvbnN0IHByZSA9IE1hdGgucm91bmQocGl4ZWxzLmxlbmd0aCAvIDI3ODAwMCk7XG4gIGNvbnN0IHNhbXBsZUZyZXF1ZW5jeSA9IE1hdGgubWF4KDEsIHByZSk7XG4gIGxldCBkYXRhID0gW107XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcGl4ZWxzLmxlbmd0aDsgaSArPSBzYW1wbGVGcmVxdWVuY3kpIHtcbiAgICBkYXRhLnB1c2goeyByOiBwaXhlbHNbaV0sIGc6IHBpeGVsc1tpICsgMV0sIGI6IHBpeGVsc1tpICsgMl0gfSk7XG4gIH1cblxuICAvLyBcdTRGN0ZcdTc1MjhrbWVhbnNcbiAgY29uc3QgY29sb3JzID0ga21lYW5zKGRhdGEsIG51bUNvbG9ycyk7XG4gIGNvbnN0IG1heFNDb2xvcnMgPSBjb2xvcnMubWFwKGl0ZW0gPT4ge1xuICAgIGNvbnN0IHJnYiA9IGl0ZW1cbiAgICAgIC5yZXBsYWNlKCdyZ2JhKCcsICcnKVxuICAgICAgLnJlcGxhY2UoJ3JnYignLCAnJylcbiAgICAgIC5yZXBsYWNlKCcpJywgJycpXG4gICAgICAuc3BsaXQoJywnKVxuICAgICAgLm1hcChsaXQgPT4gTnVtYmVyKGxpdC50cmltKCkpKTtcbiAgICBjb25zdCBoc3YgPSByZ2IyaHN2KC4uLnJnYik7XG4gICAgY29uc29sZS5sb2coaHN2LCAnLS1oc3YnKTtcbiAgICBjb25zdCBjb2xvciA9IGhzdjJyZ2IoaXNOYU4oaHN2LmgpID8gMCA6IGhzdi5oLCBoc3YucywgaHN2LnYgPiAwLjQgPyBoc3YudiArIDAuMTUgOiAwLjQpO1xuICAgIHJldHVybiBgcmdiKCR7Y29sb3Iucn0sICR7Y29sb3IuZ30sICR7Y29sb3IuYn0pYDtcbiAgfSk7XG4gIHJldHVybiBtYXhTQ29sb3JzO1xufVxuXG5mdW5jdGlvbiBrbWVhbnMoZGF0YSwgaykge1xuICBjb25zdCBjZW50cm9pZHMgPSBpbml0aWFsaXplQ2VudHJvaWRzKGRhdGEsIGspO1xuICBsZXQgY2x1c3RlcnMgPSBuZXcgQXJyYXkoayk7XG4gIGxldCBvbGRDZW50cm9pZHM7XG4gIGxldCBjaGFuZ2VkID0gdHJ1ZTtcblxuICB3aGlsZSAoY2hhbmdlZCkge1xuICAgIGNsdXN0ZXJzID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogayB9LCAoKSA9PiBbXSk7XG4gICAgZGF0YS5mb3JFYWNoKHBvaW50ID0+IHtcbiAgICAgIGxldCBjbG9zZXN0Q2VudHJvaWRJbmRleCA9IC0xO1xuICAgICAgbGV0IG1pbkRpc3RhbmNlID0gSW5maW5pdHk7XG5cbiAgICAgIGNlbnRyb2lkcy5mb3JFYWNoKChjZW50cm9pZCwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgZGlzdGFuY2UgPSBldWNsaWRlYW5EaXN0YW5jZShwb2ludCwgY2VudHJvaWQpO1xuICAgICAgICBpZiAoZGlzdGFuY2UgPCBtaW5EaXN0YW5jZSkge1xuICAgICAgICAgIGNsb3Nlc3RDZW50cm9pZEluZGV4ID0gaW5kZXg7XG4gICAgICAgICAgbWluRGlzdGFuY2UgPSBkaXN0YW5jZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGNsdXN0ZXJzW2Nsb3Nlc3RDZW50cm9pZEluZGV4XS5wdXNoKHBvaW50KTtcbiAgICB9KTtcblxuICAgIG9sZENlbnRyb2lkcyA9IGNlbnRyb2lkcy5zbGljZSgpO1xuICAgIGNlbnRyb2lkcy5mb3JFYWNoKChjZW50cm9pZCwgaW5kZXgpID0+IHtcbiAgICAgIGlmIChjbHVzdGVyc1tpbmRleF0ubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBtZWFuID0gY2FsY3VsYXRlTWVhbihjbHVzdGVyc1tpbmRleF0pO1xuICAgICAgICBjZW50cm9pZHNbaW5kZXhdID0gbWVhbjtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBjaGFuZ2VkID0gIWNlbnRyb2lkc0VxdWFsKG9sZENlbnRyb2lkcywgY2VudHJvaWRzKTtcbiAgfVxuXG4gIHJldHVybiBjZW50cm9pZHMubWFwKGNlbnRyb2lkID0+IGByZ2IoJHtjZW50cm9pZC5yfSwgJHtjZW50cm9pZC5nfSwgJHtjZW50cm9pZC5ifSlgKTtcbn1cblxuZnVuY3Rpb24gaW5pdGlhbGl6ZUNlbnRyb2lkcyhkYXRhLCBrKSB7XG4gIGNvbnN0IGNlbnRyb2lkcyA9IFtdO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGs7IGkrKykge1xuICAgIGNvbnN0IHJhbmRJbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGRhdGEubGVuZ3RoKTtcbiAgICBjZW50cm9pZHMucHVzaCh7IC4uLmRhdGFbcmFuZEluZGV4XSB9KTtcbiAgfVxuICByZXR1cm4gY2VudHJvaWRzO1xufVxuXG5mdW5jdGlvbiBldWNsaWRlYW5EaXN0YW5jZShhLCBiKSB7XG4gIHJldHVybiBNYXRoLnNxcnQoKGEuciAtIGIucikgKiogMiArIChhLmcgLSBiLmcpICoqIDIgKyAoYS5iIC0gYi5iKSAqKiAyKTtcbn1cblxuZnVuY3Rpb24gY2FsY3VsYXRlTWVhbihjbHVzdGVyKSB7XG4gIGxldCByID0gMDtcbiAgbGV0IGcgPSAwO1xuICBsZXQgYiA9IDA7XG4gIGNsdXN0ZXIuZm9yRWFjaChwb2ludCA9PiB7XG4gICAgciArPSBwb2ludC5yO1xuICAgIGcgKz0gcG9pbnQuZztcbiAgICBiICs9IHBvaW50LmI7XG4gIH0pO1xuICBjb25zdCB7IGxlbmd0aCB9ID0gY2x1c3RlcjtcbiAgcmV0dXJuIHsgcjogTWF0aC5yb3VuZChyIC8gbGVuZ3RoKSwgZzogTWF0aC5yb3VuZChnIC8gbGVuZ3RoKSwgYjogTWF0aC5yb3VuZChiIC8gbGVuZ3RoKSB9O1xufVxuXG5mdW5jdGlvbiBjZW50cm9pZHNFcXVhbChvbGRDZW50cm9pZHMsIG5ld0NlbnRyb2lkcykge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IG9sZENlbnRyb2lkcy5sZW5ndGg7IGkrKykge1xuICAgIGlmIChcbiAgICAgIG9sZENlbnRyb2lkc1tpXS5yICE9PSBuZXdDZW50cm9pZHNbaV0uciB8fFxuICAgICAgb2xkQ2VudHJvaWRzW2ldLmcgIT09IG5ld0NlbnRyb2lkc1tpXS5nIHx8XG4gICAgICBvbGRDZW50cm9pZHNbaV0uYiAhPT0gbmV3Q2VudHJvaWRzW2ldLmJcbiAgICApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG4iLCAiLypcbiAqIEBBdXRob3I6IG1qaFxuICogQERhdGU6IDIwMjQtMDktMDIgMTE6NDI6MDRcbiAqIEBMYXN0RWRpdG9yczogbWpoXG4gKiBATGFzdEVkaXRUaW1lOiAyMDI1LTAxLTAyIDE0OjA4OjUzXG4gKiBARGVzY3JpcHRpb246XG4gKi9cbmltcG9ydCB7IGV4dHJhY3RDb2xvcnMgfSBmcm9tICcuL3V0aWxzJztcblxuZXhwb3J0IGRlZmF1bHQgUmVuZGVyKHtcbiAgY3R4OiBudWxsLFxuICBjYW52YXM6IG51bGwsXG4gIHByZUlkOiAnJyxcbiAgLyoqXG4gICAqIEBuYW1lOiBcdTZFMzJcdTY3RDNcdTcwNkZcdTVFMjZcdTUyQThcdTc1M0JcbiAgICogQGRlc2M6XG4gICAqIEBwYXJhbSB7Kn0gcHJvcHNcbiAgICogQHJldHVybiB7Kn1cbiAgICovXG4gIGFzeW5jIHJlbmRlckxpZ2h0KHsgc3JjLCBjYW52YXNJZCwgcGlja051bSB9KSB7XG4gICAgaWYgKCFzcmMpIHJldHVybjtcbiAgICAvLyBcdTUyMURcdTU5Q0JcdTUzMTZcdThCQjBcdTVGNTVcdTU0OENcdTdGMjlcdTY1M0UgY2FudmFzXG4gICAgaWYgKCF0aGlzLmN0eCB8fCB0aGlzLnByZUlkICE9PSBjYW52YXNJZCkge1xuICAgICAgY29uc29sZS5sb2coJ1x1RDgzRFx1REU4MCBnZXQgdGhlIENhbnZhcyBjdHgnKTtcbiAgICAgIHRoaXMuY2FudmFzID0gYXdhaXQgZ2V0Q2FudmFzQnlJZChjYW52YXNJZCk7XG4gICAgICB0aGlzLmN0eCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICB0aGlzLnByZUlkID0gY2FudmFzSWRcbiAgICB9XG4gICAgdGhpcy5nZXRJbWFnZShzcmMsIHBpY2tOdW0pXG4gICAgXG4gIH0sXG4gIGdldEltYWdlKHNyYywgcGlja051bSkge1xuICAgIGNvbnN0IGltZyA9IHRoaXMuY2FudmFzLmNyZWF0ZUltYWdlKCk7XG5cbiAgICBpbWcub25sb2FkID0gKCkgPT4ge1xuICAgICAgY29uc3Qgd2lkdGggPSBpbWcud2lkdGg7XG4gICAgICBjb25zdCBoZWlnaHQgPSBpbWcuaGVpZ2h0O1xuICAgICAgdGhpcy5jYW52YXMud2lkdGggPSB3aWR0aDtcbiAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IGhlaWdodDtcbiAgICAgIHRoaXMuY3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuXG4gICAgICBjb25zdCBpbWFnZURhdGEgPSB0aGlzLmN0eC5nZXRJbWFnZURhdGEoMCwgMCwgd2lkdGgsIGhlaWdodCk7XG4gICAgICBjb25zdCBwaXhlbHMgPSBpbWFnZURhdGEuZGF0YTtcbiAgICAgIFxuICAgICAgLy8gXHU2M0QwXHU1M0Q2XHU5ODlDXHU4MjcyXG4gICAgICBjb25zdCBjb2xvcnMgPSBleHRyYWN0Q29sb3JzKHBpeGVscywgcGlja051bSk7XG5cbiAgICAgIHRoaXMuY2FsbE1ldGhvZCgnZ2V0Q29sb3JzJywge1xuICAgICAgICBjb2xvcnM6IGNvbG9ycyxcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBpbWcub25lcnJvciA9IGUgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ1x1Mjc0Q3JqcyBpbWcub25lcnJvcicsIGUsIGUubWVzc2FnZSk7XG4gICAgfTtcblxuICAgIGltZy5zcmMgPSBzcmM7XG4gIH1cbn0pO1xuIl0sCiAgIm1hcHBpbmdzIjogIjtBQU9BLElBQU0sUUFBUSxDQUFDLFFBQVEsS0FBSyxRQUFRLEtBQUssSUFBSSxLQUFLLEtBQUssSUFBSSxLQUFLLE1BQU0sQ0FBQztBQUVoRSxTQUFTLFVBQVU7QUFDeEIsTUFBSSxJQUFJLFVBQVUsU0FBUyxLQUFLLFVBQVUsQ0FBQyxNQUFNLFNBQVksVUFBVSxDQUFDLElBQUk7QUFDNUUsTUFBSSxJQUFJLFVBQVUsU0FBUyxLQUFLLFVBQVUsQ0FBQyxNQUFNLFNBQVksVUFBVSxDQUFDLElBQUk7QUFDNUUsTUFBSSxJQUFJLFVBQVUsU0FBUyxLQUFLLFVBQVUsQ0FBQyxNQUFNLFNBQVksVUFBVSxDQUFDLElBQUk7QUFDNUUsTUFBSSxJQUFJLFVBQVUsU0FBUyxJQUFJLFVBQVUsQ0FBQyxJQUFJO0FBQzlDLFFBQU0sTUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLEtBQUssTUFBTTtBQUNwQyxRQUFJLE9BQU87QUFDWCxRQUFJO0FBQU0sYUFBTyxXQUFXLEtBQUssU0FBUyxDQUFDO0FBQzNDLFFBQUksTUFBTSxHQUFHO0FBQ1gsY0FBUTtBQUNSLFlBQU0sTUFBTSxPQUFPLElBQUksT0FBTyxNQUFNO0FBQ3BDLGFBQU87QUFBQSxJQUNUO0FBQ0EsV0FBTyxNQUFNLEtBQUssTUFBTSxHQUFHLEdBQUcsR0FBRyxHQUFHO0FBQUEsRUFDdEMsQ0FBQztBQUNELFFBQU0sS0FBSyxLQUFLLE1BQU8sSUFBSSxDQUFDLElBQUksTUFBTyxHQUFHO0FBQzFDLE1BQUksSUFBSSxDQUFDLE1BQU07QUFBRyxXQUFPLENBQUMsSUFBSSxJQUFJLEVBQUU7QUFDcEMsUUFBTSxNQUFNLElBQUksQ0FBQztBQUNqQixRQUFNLElBQUksTUFBTTtBQUNoQixRQUFNLElBQUksS0FBSyxNQUFRLElBQUksQ0FBQyxLQUFLLE1BQU0sSUFBSSxDQUFDLEtBQU0sTUFBUyxHQUFHO0FBQzlELFFBQU0sSUFBSSxLQUFLLE1BQVEsSUFBSSxDQUFDLEtBQUssTUFBTyxJQUFJLENBQUMsSUFBSSxLQUFNLE1BQVUsR0FBRztBQUNwRSxRQUFNLElBQUksS0FBSyxNQUFRLElBQUksQ0FBQyxLQUFLLE1BQU8sSUFBSSxDQUFDLEtBQUssS0FBSyxNQUFPLE1BQVUsR0FBRztBQUMzRSxNQUFJO0FBQ0osVUFBUSxLQUFLLE1BQU0sTUFBTSxFQUFFLEdBQUc7QUFBQSxJQUM1QixLQUFLO0FBQ0gsWUFBTSxDQUFDLElBQUksR0FBRyxDQUFDO0FBQ2Y7QUFBQSxJQUNGLEtBQUs7QUFDSCxZQUFNLENBQUMsR0FBRyxJQUFJLENBQUM7QUFDZjtBQUFBLElBQ0YsS0FBSztBQUNILFlBQU0sQ0FBQyxHQUFHLElBQUksQ0FBQztBQUNmO0FBQUEsSUFDRixLQUFLO0FBQ0gsWUFBTSxDQUFDLEdBQUcsR0FBRyxFQUFFO0FBQ2Y7QUFBQSxJQUNGLEtBQUs7QUFDSCxZQUFNLENBQUMsR0FBRyxHQUFHLEVBQUU7QUFDZjtBQUFBLElBQ0Y7QUFDRSxZQUFNLENBQUMsSUFBSSxHQUFHLENBQUM7QUFDZjtBQUFBLEVBQ0o7QUFDQSxNQUFJLE1BQU0sUUFBVztBQUNuQixRQUFJLEtBQUssTUFBTSxPQUFPLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztBQUFBLEVBQ2pDO0FBQ0EsU0FBTztBQUNUO0FBRU8sU0FBUyxVQUFVO0FBQ3hCLE1BQUksSUFBSSxVQUFVLFNBQVMsS0FBSyxVQUFVLENBQUMsTUFBTSxTQUFZLFVBQVUsQ0FBQyxJQUFJO0FBQzVFLE1BQUksSUFBSSxVQUFVLFNBQVMsS0FBSyxVQUFVLENBQUMsTUFBTSxTQUFZLFVBQVUsQ0FBQyxJQUFJO0FBQzVFLE1BQUksSUFBSSxVQUFVLFNBQVMsS0FBSyxVQUFVLENBQUMsTUFBTSxTQUFZLFVBQVUsQ0FBQyxJQUFJO0FBQzVFLE1BQUksTUFBTSxXQUFXLEVBQUUsU0FBUyxDQUFDO0FBQ2pDLE1BQUksUUFBUSxXQUFXLEVBQUUsU0FBUyxDQUFDO0FBQ25DLE1BQUksT0FBTyxXQUFXLEVBQUUsU0FBUyxDQUFDO0FBQ2xDLE1BQUksTUFBTTtBQUFHLFVBQU07QUFDbkIsTUFBSSxRQUFRO0FBQUcsWUFBUTtBQUN2QixNQUFJLE9BQU87QUFBRyxXQUFPO0FBQ3JCLE1BQUksTUFBTTtBQUFLLFVBQU07QUFDckIsTUFBSSxRQUFRO0FBQUssWUFBUTtBQUN6QixNQUFJLE9BQU87QUFBSyxXQUFPO0FBQ3ZCLFNBQU87QUFDUCxXQUFTO0FBQ1QsVUFBUTtBQUNSLFFBQU0sSUFBSSxLQUFLLElBQUksS0FBSyxPQUFPLElBQUk7QUFDbkMsUUFBTSxJQUFJLEtBQUssSUFBSSxLQUFLLE9BQU8sSUFBSTtBQUNuQyxRQUFNLElBQUksSUFBSTtBQUNkLE1BQUk7QUFDSixNQUFJO0FBQ0osTUFBSTtBQUNKLE1BQUksTUFBTTtBQUFHLFFBQUk7QUFBQSxXQUNSLE1BQU07QUFBSyxTQUFNLFFBQVEsUUFBUSxJQUFLO0FBQUEsV0FDdEMsTUFBTTtBQUFPLFNBQUssT0FBTyxPQUFPLElBQUk7QUFBQTtBQUN4QyxTQUFLLE1BQU0sU0FBUyxJQUFJO0FBQzdCLE9BQUs7QUFDTCxNQUFJLElBQUk7QUFBRyxTQUFLO0FBQ2hCLE1BQUk7QUFDSixNQUFJLE1BQU07QUFBRyxRQUFJO0FBQUE7QUFDWixRQUFJLElBQUk7QUFDYixPQUFLO0FBQ0wsT0FBSztBQUNMLFNBQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQztBQUNqQjs7O0FDbEZPLFNBQVMsY0FBYyxRQUFRLFdBQVc7QUFFL0MsUUFBTSxNQUFNLEtBQUssTUFBTSxPQUFPLFNBQVMsS0FBTTtBQUM3QyxRQUFNLGtCQUFrQixLQUFLLElBQUksR0FBRyxHQUFHO0FBQ3ZDLE1BQUksT0FBTyxDQUFDO0FBQ1osV0FBUyxJQUFJLEdBQUcsSUFBSSxPQUFPLFFBQVEsS0FBSyxpQkFBaUI7QUFDdkQsU0FBSyxLQUFLLEVBQUUsR0FBRyxPQUFPLENBQUMsR0FBRyxHQUFHLE9BQU8sSUFBSSxDQUFDLEdBQUcsR0FBRyxPQUFPLElBQUksQ0FBQyxFQUFFLENBQUM7QUFBQSxFQUNoRTtBQUdBLFFBQU0sU0FBUyxPQUFPLE1BQU0sU0FBUztBQUNyQyxRQUFNLGFBQWEsT0FBTyxJQUFJLFVBQVE7QUFDcEMsVUFBTSxNQUFNLEtBQ1QsUUFBUSxTQUFTLEVBQUUsRUFDbkIsUUFBUSxRQUFRLEVBQUUsRUFDbEIsUUFBUSxLQUFLLEVBQUUsRUFDZixNQUFNLEdBQUcsRUFDVCxJQUFJLFNBQU8sT0FBTyxJQUFJLEtBQUssQ0FBQyxDQUFDO0FBQ2hDLFVBQU0sTUFBTSxRQUFRLEdBQUcsR0FBRztBQUMxQixZQUFRLElBQUksS0FBSyxPQUFPO0FBQ3hCLFVBQU0sUUFBUSxRQUFRLE1BQU0sSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLEdBQUcsSUFBSSxHQUFHLElBQUksSUFBSSxNQUFNLElBQUksSUFBSSxPQUFPLEdBQUc7QUFDdkYsV0FBTyxPQUFPLE1BQU0sQ0FBQyxLQUFLLE1BQU0sQ0FBQyxLQUFLLE1BQU0sQ0FBQztBQUFBLEVBQy9DLENBQUM7QUFDRCxTQUFPO0FBQ1Q7QUFFQSxTQUFTLE9BQU8sTUFBTSxHQUFHO0FBQ3ZCLFFBQU0sWUFBWSxvQkFBb0IsTUFBTSxDQUFDO0FBQzdDLE1BQUksV0FBVyxJQUFJLE1BQU0sQ0FBQztBQUMxQixNQUFJO0FBQ0osTUFBSSxVQUFVO0FBRWQsU0FBTyxTQUFTO0FBQ2QsZUFBVyxNQUFNLEtBQUssRUFBRSxRQUFRLEVBQUUsR0FBRyxNQUFNLENBQUMsQ0FBQztBQUM3QyxTQUFLLFFBQVEsV0FBUztBQUNwQixVQUFJLHVCQUF1QjtBQUMzQixVQUFJLGNBQWM7QUFFbEIsZ0JBQVUsUUFBUSxDQUFDLFVBQVUsVUFBVTtBQUNyQyxjQUFNLFdBQVcsa0JBQWtCLE9BQU8sUUFBUTtBQUNsRCxZQUFJLFdBQVcsYUFBYTtBQUMxQixpQ0FBdUI7QUFDdkIsd0JBQWM7QUFBQSxRQUNoQjtBQUFBLE1BQ0YsQ0FBQztBQUVELGVBQVMsb0JBQW9CLEVBQUUsS0FBSyxLQUFLO0FBQUEsSUFDM0MsQ0FBQztBQUVELG1CQUFlLFVBQVUsTUFBTTtBQUMvQixjQUFVLFFBQVEsQ0FBQyxVQUFVLFVBQVU7QUFDckMsVUFBSSxTQUFTLEtBQUssRUFBRSxTQUFTLEdBQUc7QUFDOUIsY0FBTSxPQUFPLGNBQWMsU0FBUyxLQUFLLENBQUM7QUFDMUMsa0JBQVUsS0FBSyxJQUFJO0FBQUEsTUFDckI7QUFBQSxJQUNGLENBQUM7QUFDRCxjQUFVLENBQUMsZUFBZSxjQUFjLFNBQVM7QUFBQSxFQUNuRDtBQUVBLFNBQU8sVUFBVSxJQUFJLGNBQVksT0FBTyxTQUFTLENBQUMsS0FBSyxTQUFTLENBQUMsS0FBSyxTQUFTLENBQUMsR0FBRztBQUNyRjtBQUVBLFNBQVMsb0JBQW9CLE1BQU0sR0FBRztBQUNwQyxRQUFNLFlBQVksQ0FBQztBQUNuQixXQUFTLElBQUksR0FBRyxJQUFJLEdBQUcsS0FBSztBQUMxQixVQUFNLFlBQVksS0FBSyxNQUFNLEtBQUssT0FBTyxJQUFJLEtBQUssTUFBTTtBQUN4RCxjQUFVLEtBQUssRUFBRSxHQUFHLEtBQUssU0FBUyxFQUFFLENBQUM7QUFBQSxFQUN2QztBQUNBLFNBQU87QUFDVDtBQUVBLFNBQVMsa0JBQWtCLEdBQUcsR0FBRztBQUMvQixTQUFPLEtBQUssTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQztBQUN6RTtBQUVBLFNBQVMsY0FBYyxTQUFTO0FBQzlCLE1BQUksSUFBSTtBQUNSLE1BQUksSUFBSTtBQUNSLE1BQUksSUFBSTtBQUNSLFVBQVEsUUFBUSxXQUFTO0FBQ3ZCLFNBQUssTUFBTTtBQUNYLFNBQUssTUFBTTtBQUNYLFNBQUssTUFBTTtBQUFBLEVBQ2IsQ0FBQztBQUNELFFBQU0sRUFBRSxPQUFPLElBQUk7QUFDbkIsU0FBTyxFQUFFLEdBQUcsS0FBSyxNQUFNLElBQUksTUFBTSxHQUFHLEdBQUcsS0FBSyxNQUFNLElBQUksTUFBTSxHQUFHLEdBQUcsS0FBSyxNQUFNLElBQUksTUFBTSxFQUFFO0FBQzNGO0FBRUEsU0FBUyxlQUFlLGNBQWMsY0FBYztBQUNsRCxXQUFTLElBQUksR0FBRyxJQUFJLGFBQWEsUUFBUSxLQUFLO0FBQzVDLFFBQ0UsYUFBYSxDQUFDLEVBQUUsTUFBTSxhQUFhLENBQUMsRUFBRSxLQUN0QyxhQUFhLENBQUMsRUFBRSxNQUFNLGFBQWEsQ0FBQyxFQUFFLEtBQ3RDLGFBQWEsQ0FBQyxFQUFFLE1BQU0sYUFBYSxDQUFDLEVBQUUsR0FDdEM7QUFDQSxhQUFPO0FBQUEsSUFDVDtBQUFBLEVBQ0Y7QUFDQSxTQUFPO0FBQ1Q7OztBQ3BHQSxJQUFPLHFCQUFRLE9BQU87QUFBQSxFQUNwQixLQUFLO0FBQUEsRUFDTCxRQUFRO0FBQUEsRUFDUixPQUFPO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFPUCxNQUFNLFlBQVksRUFBRSxLQUFLLFVBQVUsUUFBUSxHQUFHO0FBQzVDLFFBQUksQ0FBQztBQUFLO0FBRVYsUUFBSSxDQUFDLEtBQUssT0FBTyxLQUFLLFVBQVUsVUFBVTtBQUN4QyxjQUFRLElBQUksOEJBQXVCO0FBQ25DLFdBQUssU0FBUyxNQUFNLGNBQWMsUUFBUTtBQUMxQyxXQUFLLE1BQU0sS0FBSyxPQUFPLFdBQVcsSUFBSTtBQUN0QyxXQUFLLFFBQVE7QUFBQSxJQUNmO0FBQ0EsU0FBSyxTQUFTLEtBQUssT0FBTztBQUFBLEVBRTVCO0FBQUEsRUFDQSxTQUFTLEtBQUssU0FBUztBQUNyQixVQUFNLE1BQU0sS0FBSyxPQUFPLFlBQVk7QUFFcEMsUUFBSSxTQUFTLE1BQU07QUFDakIsWUFBTSxRQUFRLElBQUk7QUFDbEIsWUFBTSxTQUFTLElBQUk7QUFDbkIsV0FBSyxPQUFPLFFBQVE7QUFDcEIsV0FBSyxPQUFPLFNBQVM7QUFDckIsV0FBSyxJQUFJLFVBQVUsS0FBSyxHQUFHLEdBQUcsT0FBTyxNQUFNO0FBRTNDLFlBQU0sWUFBWSxLQUFLLElBQUksYUFBYSxHQUFHLEdBQUcsT0FBTyxNQUFNO0FBQzNELFlBQU0sU0FBUyxVQUFVO0FBR3pCLFlBQU0sU0FBUyxjQUFjLFFBQVEsT0FBTztBQUU1QyxXQUFLLFdBQVcsYUFBYTtBQUFBLFFBQzNCO0FBQUEsTUFDRixDQUFDO0FBQUEsSUFDSDtBQUVBLFFBQUksVUFBVSxPQUFLO0FBQ2pCLGNBQVEsSUFBSSx5QkFBb0IsR0FBRyxFQUFFLE9BQU87QUFBQSxJQUM5QztBQUVBLFFBQUksTUFBTTtBQUFBLEVBQ1o7QUFDRixDQUFDOyIsCiAgIm5hbWVzIjogW10KfQo=
