## 如何开发灯带涂抹功能

### 0. 能力介绍

- [涂抹功能]一般用于幻彩灯带上，由于灯带一般是多个灯珠串联的，可展示效果比较绚丽复杂，允许用户自行配置颜色，所以有了涂抹的能力
- 注意灯带的灯珠数目一般不等于灯段数，灯珠数目 >> 灯段数, 灯段数可以配置一般为 20 段
- 涂抹的能力主要分为三种类型：
  - a. 全选也称为 ‘油漆桶’，选中这个模式时，所有灯段颜色统一变化
  - b. 单选也称为 ‘铅笔’，选中这个模式时，只有当涂抹到的灯段才会变化
  - c. 擦除也称为 ‘橡皮擦’, 选中这个模式时，只有当涂抹到的灯段会关闭，页面上的效果为置灰

### 1. 根据 UI 设计图分析灯带类型

- 1.1 一般情况下，是横向或者竖向排列，存在一定的重复类型。
- 1.2 分析灯带段数的排布规律，确定存在几种图形类型。
- 1.3 使用 `@ray-js/pencil-flow` 库创建自定义图形类，可参考 `src/DimmerStrip` 文件夹下代码。

### 2. 生成灯段的具体位置和颜色数据

- 2.1 位置信息生成 (代码参见 `src/utils.ts: getSharpPathPosData 函数`)
- 2.2 颜色数据生成 (代码参见 `src/utils.ts: getSharpPathColorData 函数`)
- 2.3 位置和颜色数据组合 (代码参见 `src/utils.ts: getSharpPathData 函数`)
  - 组合上面两个函数，生成最终的位置和颜色数据

### 3. 根据灯段数据和分析的图形类进行具体渲染

- 3.1 根据数据渲染具体图形时，添加 `touchmove` 和 `touchend` 事件，当某个灯段图形被点击时，获取到被点击图形具体信息，可以从中得到具体被点击的图形 (代码参见 `src/DimmerStrip/index`)
- 3.2 得到被点击的图形，通过事件 `callMethod` 传递当前图形的索引，可以在外部 `touchmove` 和 `touchend` 事件回调中更新 `lightColorMaps` 数据，通过属性重新传入我们实现的涂抹组件中，会自动渲染新的颜色 (代码参见 `src/index`)
